<%
/**
 * hashCode function.
 *
 * @param str str
 * @returns {number}
 */
var hashCode = function (str) {
    if (!str && str.length === 0) {
        return 0;
    }

    var hash = 0;
    for (var i = 0, len = str.length; i < len; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash |= 0;
    }
    return hash;
};

// init year and month variable.
var year = '1970';
var month = '1970-01';
var m = '';
var day = '';
posts = posts || [];
%>

<div id="cd-timeline" class="container">
    <% posts.sort(function(a, b) {
      return b - a;
    }).forEach(function(post) { %>
        <div clfss="cd-timeline-block">
            <% if (date(post.date, 'YYYY') != year) { %>
            <% year = date(post.date, 'YYYY'); %>
                <div class="cd-timeline-img year" data-aos="zoom-in-up">
                    <a href="<%- url_for('/archives/' + year) %>">
                        <%= year %>
                    </a>
                </div>
            <% } %>

            <!-- 不要用模板的注释，会导致问题 -->
            <%
                day = date(post.date, 'YYYY-MM-DD').substring(8, 10);
            %>
            <% if (date(post.date, 'YYYY-MM') != month) { %>
                <%
                    month = date(post.date, 'YYYY-MM');
                    m = date(post.date, 'MM')
                %>
                <div class="cd-timeline-img month" data-aos="zoom-in-up">
                    <a href="<%- url_for('/archives/' + year + '/' + m) %>">
                        <%= m %>
                    </a>
                </div>
            <% } %>

            <div class="cd-timeline-img day" data-aos="zoom-in-up">
                <span><%= day %></span>
            </div>

            <article class="cd-timeline-content" data-aos="fade-up">
                <div class="card p-4">
                    <a href="<%- url_for(post.path) %>">
                        <h5 class="card-title"><%= post.title %></h5>
                    </a>
                    <div class="card-content article-content">
                        <% if (post.summary && post.summary.length > 0) { %>
                            <%- post.summary %>
                        <% } else { %>
                            <%- strip_html(post.content).substring(0, 120) %>
                        <% } %>
                    </div>
                    <div class="row mt-2">
                        <span class="col-6">
                            <i class="far fa-clock fa-fw icon-date"></i><%= date(post.date, config.date_format) %>
                        </span>
                        <span class="col-6">
                            <% if (post.author && post.author.length > 0) { %>
                                <i class="fas fa-user fa-fw"></i>
                                <%- post.author %>
                            <% } else { %>
                                <i class="fas fa-user fa-fw"></i>
                                <%- config.author %>
                            <% } %>
                        </span>
                    </div>
                    
                    <hr>
                    <% if (post.tags && post.tags.length) { %>
                        <div class="tags-wrapper">
                            <% post.tags.forEach(tag => { %>
                             <a href="<%- url_for(tag.path) %>" class="chip bg-color-active p-2 hover-no-under"><%= tag.name %></a>
                            <% }); %>
                        </div>
                    <% } %>
                </div>
            </article>
        </div>
    <% }); %>
</div>